
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Edit Job - Trial Shift</title>
  <link rel="stylesheet" href="/css/job-post.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" rel="stylesheet">
</head>
<body>
  <div class="container">
    <h1>Edit Job</h1>
    <div class="row">
      <div class="col s12">
        <div class="card">
          <div class="card-content">
            <form action="/api/jobs/" method="POST" id="editForm">
              <input type="hidden" id="jobId" name="jobId">
              <div class="row">
                <div class="input-field col s12">
                  <input type="text" id="title" name="title" required>
                  <label for="title">Job Title</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <select id="category" name="category" required>
                    <option value="" disabled selected>Choose a category</option>
                    <option value="kitchenhand">Kitchen Hand</option>
                    <option value="cleaning">Cleaning</option>
                    <option value="delivery">Delivery</option>
                    <option value="waiter">Waiter</option>
                    <option value="barista">Barista</option>
                    <option value="pickpacker">Pick Packer</option>
                  </select>
                  <label for="category">Category</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <input type="text" id="location" name="location" required>
                  <label for="location">Location</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <textarea id="shiftDetails" name="shiftDetails" class="materialize-textarea" required></textarea>
                  <label for="shiftDetails">Shift Details</label>
                </div>
              </div>
              <div class="row">
                <div class="input-field col s12">
                  <button type="submit" class="btn">Update Job</button>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col s12 center-align">
        <a href="/job-post" class="btn">Back to Job Posting</a>
      </div>
    </div>
  </div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      M.AutoInit();
      M.updateTextFields();

      // Get job ID from query parameter
      const urlParams = new URLSearchParams(window.location.search);
      const jobId = urlParams.get('id');
      if (!jobId) {
        console.error('No job ID provided');
        alert('No job selected for editing.');
        window.location.href = '/job-post';
        return;
      }
      document.getElementById('jobId').value = jobId;

      // Fetch job data to populate the form
      fetch(`/api/jobs/${jobId}`)
        .then(response => {
          if (!response.ok) throw new Error('Network response was not ok');
          return response.json();
        })
        .then(job => {
          document.getElementById('title').value = job.title || '';
          document.getElementById('location').value = job.location || '';
          document.getElementById('shiftDetails').value = job.shiftDetails || '';
          const categorySelect = document.getElementById('category');
          categorySelect.value = job.category.name || job.category || '';
          M.FormSelect.init(categorySelect); // Reinitialize select after setting value
        })
        .catch(error => console.error('Error fetching job data:', error));

      const form = document.querySelector('#editForm');
      form.action = `/api/jobs/${jobId}`; // Dynamic action URL
      form.method = 'PUT'; // Use PUT for update
      form.addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(form);
        const data = Object.fromEntries(formData);
        console.log('Edit data:', data);
        fetch(form.action, {
          method: 'PUT',
          body: new URLSearchParams(data),
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          }
        })
          .then(response => {
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response.json();
          })
          .then(data => {
            console.log('Edit success:', data);
            alert('Job updated successfully!');
            window.location.href = '/job-post';
          })
          .catch(error => console.error('Edit error:', error));
      });
    });
  </script>
</body>
</html> 